{% set prod = THIS.get('prod') %}
<form action="{{ APP.href('prodreviews/add') }}" method="post" class="f-prod-reviews" id="f-prod-reviews-main-form">
    <input type="hidden" name="pid" value="{{ prod.id() }}">

    <h1 class="f-prod-name">{{ prod.get('product_name') }}</h1>

    <div class="f-prod-review-attrs">
        <dl class="dl-horizontal">
            <dt><strong>{{ 'Overall'|_ }}</strong></dt>
            <dd>
                <input type="range" min="0" max="5" value="0" step="1" id="prodreview-rating" name="review[rating]">
                <div class="rateit" data-rateit-backingfld="#prodreview-rating"></div>
            </dd>
            <dt>{{ 'Value'|_ }}</dt>
            <dd>
                <input type="range" min="0" max="5" value="0" step="1" id="prodreview-rating1" name="review[rating1]">
                <div class="rateit" data-rateit-backingfld="#prodreview-rating1"></div>
            </dd>
            <dt>{{ 'Features'|_ }}</dt>
            <dd>
                <input type="range" min="0" max="5" value="0" step="1" id="prodreview-rating2" name="review[rating2]">
                <div class="rateit" data-rateit-backingfld="#prodreview-rating2"></div>
            </dd>
            <dt>{{ 'Quality'|_ }}</dt>
            <dd>
                <input type="range" min="0" max="5" value="0" step="1" id="prodreview-rating3" name="review[rating3]">
                <div class="rateit" data-rateit-backingfld="#prodreview-rating3"></div>
            </dd>
        </dl>
    </div>
    <div class="form-group">
        <label for="review-title">{{ 'Review Title'|_ }}</label>
        <div class="controls">
            <input type="text" name="review[title]" placeholder="{{"Title" | _ }}" class="form-control"/>
        </div>
    </div>
    <div class="form-group">
        <label for="review-text">{{ 'Review Text'|_ }}</label>
        <div class="controls">
            <textarea name="review[text]" placeholder="{{"Your review here" | _ }}" class="form-control" style="resize:vertical"></textarea><br/>
        </div>
    </div>
    <input type="submit" class="btn" id="review_save">
</form>

<script>
    require(['jquery', 'jquery.rateit', 'jquery.bootstrap-growl'], function($) {
        {% if (THIS.get('isModalBox') == 1) %}
        var mainForm = $('form#f-prod-reviews-main-form');

        $('input#review_save').click(function (ev) //todo: write function for same feature in fcom
        {
            $.ajax({
                type: "POST",
                url: mainForm.attr('action'),
                data: mainForm.serialize(),
                success: function (data)
                {
                    if (data.status == 'error') {
                        $.bootstrapGrowl("Error:<br>" + data.message, { type: 'danger', align: 'center', width: 'auto', delay: 5000});
                    } else if (data.status == 'success'){
                        $.bootstrapGrowl("Saved", { type: 'success', align: 'center', width: 'auto' });
                        $('#f-prod-review-form').modal('hide');
                        mainForm[0].reset();
                        mainForm.find('.rateit-reset').click();
                        //update list previews
                        $('#f-prod-reviews-container').load('{{ APP.href('prodreviews/reviews_list') }}?pid={{ prod.id() }}')
                    } else {
                        console.log(data);
                        alert("Invalid data, please check again");
                    }
                },
                error: function (xhr, textStatus, errorThrown)
                {
                    alert("[ERROR]<br>" + textStatus);
                }
            });

            ev.preventDefault();
            ev.stopPropagation();

            return false;
        });
        {% endif %}
    });
</script>
