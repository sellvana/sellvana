#categories_unset
#categories

- $prodCtrl = FCom_Catalog_Admin_Controller_Products::i()

:javascript
    $(function() {

        FCom.Admin.tree('#categories', {
            url:'#{BApp::href('catalog/categories/tree_data?id='.$this->model->id())}',
            checkbox: {
                override_ui:true,
                checked_parent_open:true,
                real_checkboxes:true,
                two_state: true
            },
            initially_open: #{$prodCtrl->linkedCategoriesData($this->model)}
        });
        $('#categories').bind('loaded.jstree', function(event, data) {
            var checked = #{$prodCtrl->linkedCategoriesData($this->model) };
            for (var id in checked) {
                jQuery("<input>").attr("type", "hidden").attr("name", checked[id]).val(0).appendTo('#categories_unset');
                data.inst.check_node('#'+checked[id]);
            }
        });
        $('#categories').bind('after_open.jstree', function(event, data) {
            var checked = #{$prodCtrl->linkedCategoriesData($this->model)};
            for (var id in checked) {
                data.inst.check_node('#'+checked[id]);
            }
        });

        $('#categories').css({overflowY:'auto'}).resizeWithWindow({initBy:'.adm-content-box'});
    })
