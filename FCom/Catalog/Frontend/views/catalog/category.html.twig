{% set category = APP.get('current_category') %}
{% set parts = category.getPageParts(true) %}
<div class="f-site-main" role="main">
  <div class="container">
   <!--  breadcrumb -->
    <ul class="breadcrumb">
      <li><a href="{{ APP.href() }}">Home</a></li>
      <li class="active">{{ category.get('node_name') }}</li>
    </ul>
    <header class="f-page-header visible-xs">
      <span class="f-page-title">{{ category.get('node_name') }}</span>
      <a href="javascript:void(0);" id="button" class="f-mb-slideout-menu-toggle btn btn-default visible-xs">{{ 'Filters'|_ }}</a>
    </header>
    <div class="row f-mb-slideout-menu">
      <!-- Category -->
      <div class="f-col-main {{ category.get('show_sidebar') ? 'col-sm-9' : 'col-sm-12' }}">
        <header class="f-page-header hidden-xs">
          <h1 class="f-page-title">{{ category.get('node_name') }}</h1>
        </header>
        {% for part, label in parts %}
          {% if part == 'sub_cat' %}

              {% set subCategories = category.children() %}
              <div class="row f-catalog-sub-categories">
              {% if subCategories|length %}
                  <ul>
                  {% for subCat in subCategories %}
                      {% set subCatImg = subCat.image() %}
                      <li class="col-md-6 list-unstyled">
                          <a href="{{ subCat.url() }}" title="{{ subCat.get('node_name') }}">
                              <img src="{{ APP.instance('FCom_Core_Main').resizeUrl() }}?s=98x98&f={{ subCatImg ? subCatImg : 'media/image-not-found.jpg' }}"
                                   alt="{{ subCat.get('node_name') }}" />
                          </a>
                          <a href="{{ subCat.url() }}" title="{{ subCat.get('node_name') }}">{{ subCat.get('node_name') }}</a>
                      </li>
                  {% endfor %}
                  </ul>
              {% else %}
                  {{ 'No sub-categories.'|_ }}
              {% endif %}
              </div>

          {% elseif part == 'content' %}

            <div class="f-catalog-main-content">
                {{ category.get('content') | raw }}
            </div>

          {% elseif part == 'content' %}

            {% set viewInfo = category.get('view_name') | split(':') %}
            {% if viewInfo[0] == 'view' %}

              {{ THIS.view(viewInfo[1]) }}

            {% elseif viewInfo[0] == 'block' %}

              {% set blockView = APP.instance('FCom_Cms_Frontend_View_Block').createView(viewInfo[1]) %}
              {{ blockView | raw }}

            {% endif %}

          {% elseif part == 'products' %}

            {{ THIS.hook('main_products') | raw }}

          {% endif %}

        {% endfor %}
      </div>
      {% if category.get('show_sidebar') %}
        <!-- Sidebar Start -->
        <aside class="f-col-sidebar col-sm-3 ">
            {{ THIS.hook('sidebar-left') | raw }}
        </aside>
        <!-- Sidebar End -->
      {% endif %}
    </div>
  </div>
</div>
<script>
  require(['jquery'], function($) {
    $( "#button" ).click(function() {
      $('.f-mb-slideout-menu .f-col-sidebar').toggleClass( "open" );
    });
  });
</script>
